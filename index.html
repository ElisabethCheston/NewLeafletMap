<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="/css/panelLayers.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.5.0/dist/esri-leaflet.js" integrity="sha512-ucw7Grpc+iEQZa711gcjgMBnmd9qju1CICsRaryvX7HJklK0pGl/prxKvtHwpgm5ZHdvAil7YPxI1oWPOWK3UQ==" crossorigin=""></script>
    <!-- Reference cluster plug-in and esri feature layer 
    <script src="lib/markercluster/leaflet.markercluster.js"></script> -->

    <title>Document</title>
    <style>
        html, body, #map {
            height: 100%;
            padding: 0px;
            margin: 0px;
        }
        /* MARKERS */
        .leaflet-marker-icon {
            padding: 2px;
            text-align: center;
        }
        .marker-bar {
            background: url('images/kitespots.png') center center no-repeat;
        }

        .icon {
            display: inline-block;
            margin: 2px;
            height: 16px;
            width: 16px;
            background-color: #ccc;
        }

        /* ICONS */
        .icon-bar {
            background: url('images/kitespots.png') center center no-repeat;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="/js/panelLayers.js"></script>
        <!--GeoJson data-->
    <script src="/js/kitespots.js"></script>
    <script src="/js/cities.js"></script>

    <script>

            // - Create and load an ArcGIS basemap - //
        var map = L.map('map', {
            center: [62.45,17.45],
            zoom: 5
        }),
            // - Basemap - //
        baseImagery = L.layerGroup();
        L.esri.basemapLayer('ImageryClarity').addTo(map);


            // - Show data; name and wind direction for each spot - // 
        function onEachFeature(feature, layer) {
		var popupContent = "<p><b> "+feature.properties.name + "</b><br/>" + "Wind Direction: " + feature.properties.windDirection + "</p>";
            if (feature.properties && feature.properties.popupContent) {
				popupContent += feature.properties.popupContent;
			}
		    layer.bindPopup(popupContent);
        }

            // - Controlbox basemap layers - //
        var basemapLayers = [
                {
                group: "Maps",
                icon: iconByName(''),
                collapsed: true,
                layers: [
                    {
                        name: "Hybrid",
                        icon:  iconByName(''),
                        layer: L.esri.basemapLayer("ImageryClarity")
                    },
                    {
                        name: "Topographic",
                        icon:  iconByName(''),
                        layer: L.esri.basemapLayer("Topographic")
                    },
                    {
                        name: "Streets",
                        icon:  iconByName(''),
                        layer: L.esri.basemapLayer("Streets")
                    }
                ]
            }
        ];

            // - Controlbox overlayers - //
        var overLays = [
            {
                Name: "Kitespots",
                icon: iconByName(''),
                layer: L.geoJson(Kitespots, {pointToLayer: featureToMarker})
            },
            {
                Name: "Cities",
                icon: iconByName(''),
                layer: L.geoJson(cities, {pointToLayer: featureToMarker})
            }
        ];

            // - Add it all to the map - //
        var panelLayers = new L.Control.PanelLayers(basemapLayers, overLays, {
            collapsibleGroups: true,
            collapsed: true
        });
        map.addControl(panelLayers);

            // - Icons for each feature in control layer - //
        function iconByName(name) {
            return '<i class="icon icon-'+name+'"></i>';
        }
             // - Marker icons on map - //       
        function featureToMarker(feature, latlng) {
            return L.marker(latlng, {
                icon: L.divIcon({
                    className: 'marker-'+feature.properties.amenity,
                    html: iconByName(feature.properties.amenity),
                    iconUrl: '/images/markers/'+feature.properties.amenity+'.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                })
            });
        }
            // - Overlayers  - //
        //var myLayer = L.layerGroup().addTo( map );

</script>


    </body>
</html>